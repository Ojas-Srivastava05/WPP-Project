{% extends 'base.html' %}
{% load static %}

{% block title %}Calendar - Clubify{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

    <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white flex items-center gap-3">
                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>
                Campus Calendar
            </h1>
            <p class="text-gray-400 mt-1">Keep track of your club events and meetings.</p>
        </div>

        <div class="flex gap-3 text-sm">
            <span class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-blue-500"></span> My Events
            </span>
            <span class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-purple-500"></span> Club Events
            </span>
        </div>
    </div>

    <!-- Calendar Container -->
    <div class="bg-gray-800 rounded-2xl shadow-xl border border-gray-700 p-6">
        <!-- FullCalendar injects here -->
        <div id="calendar" class="text-gray-200"></div>
    </div>

</div>

<!-- FullCalendar Integration -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<style>
    /* Tailwind overwrites for FullCalendar UI */
    .fc-theme-standard td,
    .fc-theme-standard th,
    .fc-theme-standard .fc-scrollgrid {
        border-color: #374151;
    }

    .fc-theme-standard .fc-col-header-cell {
        background-color: #1f2937;
        padding: 10px 0;
        font-weight: 600;
        color: #9ca3af;
    }

    .fc .fc-button-primary {
        background-color: #2563eb;
        border-color: #2563eb;
        font-weight: 600;
        text-transform: capitalize;
        border-radius: 0.5rem;
        transition: background-color 0.2s;
    }

    .fc .fc-button-primary:hover {
        background-color: #1d4ed8;
    }

    .fc .fc-button-primary:disabled {
        background-color: #3f83f8;
        border-color: #3f83f8;
        opacity: 0.6;
    }

    .fc .fc-button-active {
        background-color: #1e3a8a !important;
        border-color: #1e3a8a !important;
    }

    .fc .fc-daygrid-day-number {
        color: #d1d5db;
        padding: 8px;
        font-weight: 500;
    }

    .fc .fc-day-today {
        background-color: rgba(37, 99, 235, 0.1) !important;
    }

    .fc .fc-event {
        border: none;
        padding: 2px 4px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
    }

    .fc h2.fc-toolbar-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #f3f4f6;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        // Prepare Django data into JS format securely
        var eventsData = [
            {% for event in events %}
            {
            title: '{{ event.title|escapejs }}',
            start: '{{ event.start_time|date:"Y-m-d\\TH:i:s" }}',
            end: '{{ event.end_time|date:"Y-m-d\\TH:i:s" }}',
            allDay: {{ event.all_day | yesno: "true,false" }},
        backgroundColor: '{% if event.club %}#8b5cf6{% else %}#3b82f6{% endif %}', // Purple for club, Blue for personal
            }{% if not forloop.last %}, {% endif %}
    {% endfor %}
        ];

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        height: 'auto',
        navLinks: true,
        dayMaxEvents: true,
        events: eventsData,
        eventClick: function (info) {
            // Future expansion: open a beautiful modal with event details
            alert('Event: ' + info.event.title);
        }
    });

    calendar.render();
    });
</script>
{% endblock %}